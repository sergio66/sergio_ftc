Readme file for Fit_ftc
Scott Hannon, 07 February 2011
-------------------------------------------------------------------------------
The Fit_ftc directory contains most of the regression codes needed to construct
a fast model.  The main code for the transmittances (actually optical depths)
is in dir Src_fitftc.  This is a fortran code with makefiles set up to compile
a suit of related codes.  In general I usually do seven sets of coefs:
set1=fwo ,set2=fow, set3=fmw, set4=fcow, set5=fwo bfsw, set6= fwo mfmw,
and set7=fwo mfbw. sets 1-3 are long and medium wave, and sets 4-7
are shortwave.  The longwave regression transmittances span 6 angles
while the shortwave span 12 angles (the same 6 plus another 6 for
large reflected solar total path angles).  Besides these, there is
also OPTRAN water which is done for set1 and set3.  The variable CO2
is also done for all sets except set3.

In the case of interferometer instruments, the SRFs convolutions
often produce slightly invalid transmittances which might be a little
bigger than one or a little less than zero. The include files for the
interferometer instruments generally have recommended thresholds for
"TAUMIN" etc, usually with one set of thresholds uncommented and one
or more sets commented out.  You will need to run with at least two
versions of the thresholds so you can reduce errors in a small number
of channels which work much better with one set of thresholds than with
the other.  Note that AIRS and MODIS are not interferometers and thus
this issue does not apply to those instruments.

A related issue has to do with transmittance coefs blacking out
before reaching layer 100.  The goods news is that if the trans
it blacked out, it is obviously not important to radiative transfer.
However, the blacks can occur a little earlier than desireable from
a RMS errors reduction point of view.  I have matlab code to flip
thru the coefs and plot out what they look like for each channel
in turn on all 100 layers.  Before a channel blacks out and the
coefs all go to zero, typical the number of coefs with start dropping
off and the coefs will drastically change behavior.  Usually things
are OK, but sometimes weird/bad things happen in the last or next
to last layer.  If often replace the coefs in the "bad" layers with
the values in the layer above.  I may repeat the value for a few
layers to extend the non-zero coefs down one or two layers below
where they orginally zeroed out.  These occasional blowups as the
trans blacks out can occur for AIRS as well as interferometers.
See the Coef/check*m matlab scripts.

The Fit_so2, Fit_n2o, etc dirs are for those trace gases. The
code is matlab, and should be easy to run off without needing
to do multiple "sets" of coefs.  And similar for Fit_therm.

The Src_merge_cut is for codes to merge transmittance coefs or cut them,
for example to subset for particular channels.  The merging mostly
involves appending the water continuum coefs to the other trans coefs, but
in the case of optran water it instead appends the OPTRAN grid and
mean predictors.

The Src_useconv is used to generate radiances from
the transmittance regression data together with the water continuum.
The radiances thus generated can be used to comapre with radiances
generated with the fast trans coefs, but that requires using a hacked
version of SARTA to remove the fixed gases adjustment, and to use
constant secant angles (ie same angle all layers).  Note in general
since you'll have transmittance sets such as "long_fow" and "long_fwo"
and "fmw" you'll have different useconv transmittances for each of
those sets.  You want the minimum RMS errors between the fast model
and useconv radiances, but you also need to know which channels NEED
certain variable gases.  For example, in the 1200-1400 wn region you
may find many channels where "fwo" works better than "fmw", but you
need to use fmw for those channels with significant sensitivity to
variable CH4.  Also, longwave fwo and fmw fast model will can either
use OPTRAN water or fwo/fmw water.  In general the OPTRAN works better,
but in cases where it makes little difference to fitting errors I do
not use OPTRAN as it is a little slower to compute.

The Scripts subdir has various scripts to run many of the executables
generated by Fit_ftc and Src_merge_cut.  I recommend you use them.


---end of file---
